@model IEnumerable<EmployeePortal.Models.Timecard>

@using PagedList.Mvc;
@using PagedList;
<link href="~/Content/PagedList.css" rel="stylesheet" />
<link href="~/Content/styles.css" rel="stylesheet" />
@{
    ViewBag.Title = "Timecards - " + ViewBag.EmployeeName;
}
<link href="~/Content/styles.css" rel="stylesheet" />
<center></center>
<div style="text-align:center">
    <h2>@ViewBag.EmployeeName - Time Cards</h2>
</div>
<div class="container">
    <ul class="breadcrumb">
        <li>@Html.ActionLink("Create New", "Create")</li>
        @*@if (ViewBag.CopyTimecardEligible == true)
        {
            <li>
                @Html.ActionLink("Copy Last Week's Timecard", "CopyLastTimecardJobCode")
            </li>
        }*@
        <li>
            @Html.ActionLink("Create Test Timecard", "CreateTestTimecard")
        </li>
        <li>
            @Html.ActionLink("Create Timecard Approval List", "CreateTimecardList")
        </li>
        @if (ViewBag.HasTimecards == true)
        {
            <li>
                @Html.ActionLink("Delete All Timecards", "DeleteAllTimecards")
            </li>
        }
    </ul>
</div>
<p>
</p>

@{
    string weSort = ViewBag.WeekEndingSort;
    string asSort = ViewBag.ApprovalStatusSort;
    string tSort = ViewBag.TypeSort;
    string ccSort = ViewBag.CustomerCodeSort;
    string jcSort = ViewBag.JobCodeSort;
    string thSort = ViewBag.TotalHoursSort;
    string tmSort = ViewBag.TotalMilesSort;
    string regSort = ViewBag.RegularHoursSort;
}
@if (Model.Count() > 0)
{
    <div class="container">
        <table class="table table-bordered table-hover table-striped">
            <tr>
                <th>
                    @if (weSort == "WeekEndingDesc")
                    {
                        weSort = "WeekEndingAsc";
                    }
                    else
                    {
                        weSort = "WeekEndingDesc";
                    }
                    @Html.ActionLink("Week Ending", "Index", new { sortOrder = weSort })
                </th>
                <th>
                    @if (asSort == "ApprovalStatusDesc")
                    {
                        asSort = "ApprovalStatusAsc";
                    }
                    else
                    {
                        asSort = "ApprovalStatusDesc";
                    }
                    @Html.ActionLink("Approval Status", "Index", new { sortOrder = asSort })
                </th>

                <th>
                    @if (ccSort == "CustomerCodeDesc")
                    {
                        ccSort = "CustomerCodeAsc";
                    }
                    else
                    {
                        ccSort = "CustomerCodeDesc";
                    }
                    @Html.ActionLink("Customer Code", "Index", new { sortOrder = ccSort })
                </th>

                <th>
                    @if (jcSort == "JobCodeDesc")
                    {
                        jcSort = "JobCodeAsc";
                    }
                    else
                    {
                        jcSort = "JobCodeDesc";
                    }
                    @Html.ActionLink("Job Code", "Index", new { sortOrder = jcSort })
                </th>

                <th>
                    @if (regSort == "RegularHoursDesc")
                    {
                        regSort = "RegularHoursAsc";
                    }
                    else
                    {
                        regSort = "RegularHoursDesc";
                    }
                    @Html.ActionLink("Regular Hours", "Index", new { sortOrder = regSort })
                </th>

                <th>
                    @if (thSort == "TotalHoursDesc")
                    {
                        thSort = "TotalHoursAsc";
                    }
                    else
                    {
                        thSort = "TotalHoursDesc";
                    }
                    @Html.ActionLink("Total Hours", "Index", new { sortOrder = thSort })
                </th>

                <th>
                    @if (tmSort == "TotalMilesDesc")
                    {
                        tmSort = "TotalMilesAsc";
                    }
                    else
                    {
                        tmSort = "TotalMilesDesc";
                    }
                    @Html.ActionLink("Total Miles", "Index", new { sortOrder = tmSort })
                </th>
                <th></th>
            </tr>
            @foreach (var item in Model)
            {
                <tr>
                    <td>
                        @*@if (item.TimecardSubmitted)
                            {
                                    <span class="glyphicon glyphicon-saved"></span>
                                }*@
                        @Html.DisplayFor(modelItem => item.WeekEnding)
                    </td>
                    <td>
                        @if (item.ApprovalStatus == "Approved")
                    {
                            <span class="glyphicon glyphicon-check"></span>
                        }
                        else if (item.ApprovalStatus == "Rejected")
                        {
                            <span class="glyphicon glyphicon-hand-down"></span>
                        }
                        else if (item.ApprovalStatus == "Submitted")
                        {
                            <span class="glyphicon glyphicon-saved"></span>
                        }
                        @Html.DisplayFor(modelItem => item.ApprovalStatus)
                    </td>
                    <td>
                        @Html.DisplayFor(modelItem => item.CustomerCode)
                    </td>
                    <td>
                        @Html.DisplayFor(modelItem => item.JobCode)
                    </td>
                    <td class="td-center">
                        @Html.DisplayFor(modelItem => item.TotalRegular)
                        @Html.HiddenFor(modelItem => item.TotalRegular)
                    </td>
                    <td class="td-center">
                        @Html.DisplayFor(modelItem => item.TotalHours)
                        @Html.HiddenFor(modelItem => item.TotalHours)
                    </td>
                    <td class="td-center">
                        @Html.DisplayFor(modelItem => item.TotalMiles)
                        @Html.HiddenFor(modelItem => item.TotalMiles)
                    </td>
                    <td>
                        @Html.ActionLink("View", "Edit", new { id = item.Id }) |
                        @Html.ActionLink("Details", "Details", new { id = item.Id }) |
                        @Html.ActionLink("Delete", "Delete", new { id = item.Id })
                    </td>
                </tr>
            }
        </table>
        @if (ViewBag.CopyTimecardEligible == true)
        {
            <div class="form-group">
                <div class="col-md-2 pull-right">
                    <input type="button" id="btnCopyLastTimecard" name="submit" value="Copy Last Week's Timecard" class="btn btn-primary btn-sm" />
                    @*<button type="button" id="btnCopyLastTimecard" name="submit" class="btn btn-primary btn-sm">
                            <span class="glyphicon glyphicon-copy">Copy Last Week's Timecard </span>
                        </button>*@
                </div>
            </div>
        }
    </div>
    <div class="row">
        <div class="col-md-12">
            <div id="modal-container" class="modal fade" role="dialog">
            </div>
        </div>
    </div>
}
else
{
    <hr />
    <br /><br />
    <div style="text-align:center">
        <h3>You currently do not have any timecards</h3>
    </div>
}
<br />
@if (ViewBag.Paging == "ShowPaging")
{
    @Html.PagedListPager((IPagedList)Model, page => Url.Action("Index", new { page, sortOrder = Request.QueryString["sort"] }))
}
<script>
    $('#btnCopyLastTimecard').click(function () {
        $.ajax({
            type: 'GET',
            cache: false,
            datatype: 'json',
            contentType: 'application/json',
            url: '@Url.Action("ShowCopyModal", "Timecards")',
            success: function (result) {
                $('#modal-container').modal('show').html(result);
            }
        });
    });
    function showCopyModal() {
        $.ajax({
            type: 'GET',
            cache: false,
            datatype: 'json',
            contentType: 'application/json',
            url: '@Url.Action("ShowCopyModal")',
            success: function (result) {
                $('#modal-container').modal('show').html(result);
            }
        });

    }
</script>